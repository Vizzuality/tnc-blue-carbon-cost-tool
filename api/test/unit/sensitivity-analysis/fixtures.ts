import {
  CalculatorCostPlansOutput,
  EngineInput,
  SensitivityAnalysisInput,
  SequestrationRateOutputs,
} from '@api/modules/calculations/types';

import { RevenueProfitCalculator } from '@api/modules/calculations/calculators/revenue-profit.calculator';
import { ACTIVITY } from '@shared/entities/activity.enum';
import { ECOSYSTEM } from '@shared/entities/ecosystem.enum';
import { CARBON_REVENUES_TO_COVER } from '@shared/entities/custom-project.entity';
import { PROJECT_DEVELOPMENT_TYPE } from '@shared/dtos/projects/project-development.type';

const engineInput = {
  projectInput: {
    projectName: 'Conservation_Mangrove_Indonesia',
    countryCode: 'IDN',
    activity: 'Conservation' as ACTIVITY,
    ecosystem: 'Mangrove' as ECOSYSTEM,
    projectSizeHa: 10000,
    initialCarbonPriceAssumption: 20,
    carbonRevenuesToCover: 'Opex' as CARBON_REVENUES_TO_COVER,
    lossRate: -0.001,
    emissionFactorAgb: 355.398393765212,
    emissionFactorSoc: 71.8766416255785,
    emissionFactor: null,
    costAndCarbonInputs: {
      feasibilityAnalysis: 50000,
      conservationPlanningAndAdmin: 166766.666666667,
      dataCollectionAndFieldCost: 26666.6666666667,
      communityRepresentation: 71183.3333333333,
      blueCarbonProjectPlanning: 100000,
      establishingCarbonRights: 46666.6666666667,
      validation: 50000,
      implementationLabor: 0,
      monitoring: 15000,
      maintenance: 0.0833,
      communityBenefitSharingFund: 0.5,
      carbonStandardFees: 0.2,
      baselineReassessment: 40000,
      mrv: 75000,
      longTermProjectOperatingCost: 26400,
      financingCost: 0.05,
      maintenanceDuration: 3,
      ecosystemLossRate: 0,
      restorableLand: 204536.1679,
      tier1EmissionFactor: 27.2,
      emissionFactorAgb: 355.398393765212,
      emissionFactorSoc: 71.8766416255785,
      tier1SequestrationRate: 5.94,
      tier2SequestrationRate: 29.5,
      otherCommunityCashFlow: 'Development' as PROJECT_DEVELOPMENT_TYPE,
    },
    assumptions: {
      verificationFrequency: 5,
      baselineReassessmentFrequency: 10,
      discountRate: 0.04,
      carbonPriceIncrease: 0.015,
      buffer: 0.2,
      projectLength: 20,
      annualCostIncrease: 0,
      carbonPrice: 20,
      siteSpecificEcosystemLossRate: -0.00244205185747926,
      interestRate: 0.05,
      loanRepaymentSchedule: 10,
      soilOrganicCarbonReleaseLength: 10,
      plantingSuccessRate: 0.8,
      startingPointScaling: 20000,
      defaultProjectLength: 40,
    },
  },
  baseIncrease: {
    id: '5c75b484-4d02-4e8d-8710-610d9652fbad',
    ecosystem: 'Mangrove' as ECOSYSTEM,
    feasibilityAnalysis: 0,
    conservationPlanningAndAdmin: 0.25,
    dataCollectionAndFieldCost: 1,
    communityRepresentation: 0.5,
    blueCarbonProjectPlanning: 0,
    establishingCarbonRights: 0,
    financingCost: 0,
    validation: 0,
    monitoring: 1,
    baselineReassessment: 0,
    mrv: 0,
    longTermProjectOperatingCost: 0.25,
  },
  baseSize: {
    id: '96105849-fba6-4c70-86dd-4a5f51b8a8da',
    ecosystem: 'Mangrove',
    activity: 'Conservation',
    feasibilityAnalysis: 20000,
    conservationPlanningAndAdmin: 20000,
    dataCollectionAndFieldCost: 20000,
    communityRepresentation: 20000,
    blueCarbonProjectPlanning: 20000,
    establishingCarbonRights: 20000,
    financingCost: 20000,
    validation: 20000,
    implementationLaborPlanting: 0,
    implementationLaborHybrid: 0,
    implementationLaborHydrology: 0,
    monitoring: 20000,
    baselineReassessment: 20000,
    mrv: 20000,
    longTermProjectOperatingCost: 20000,
  },
} as EngineInput;

engineInput.dto = {
  activity: engineInput.projectInput.activity,
  ecosystem: engineInput.projectInput.ecosystem,
  parameters: {},
};

const sequestrationRateOutputs = {
  baselineEmissionsCostPlan: undefined,
  estimatedCreditIssuedPlan: {
    '1': 3465.720283126324,
    '2': 4084.7876958477495,
    '3': 4703.236041156353,
    '4': 5321.065938120514,
    '5': 5938.278005186254,
    '6': 6554.872860186063,
    '7': 7170.851120330404,
    '8': 7786.213402215039,
    '9': 8400.960321817134,
    '10': 9015.09249449988,
    '11': 9053.597402005747,
    '12': 9092.063804603205,
    '13': 9130.491740799065,
    '14': 9168.881249057775,
    '15': 9207.232367809502,
    '16': 9245.545135440576,
    '17': 9283.819590305962,
    '18': 9322.055770715639,
    '19': 9360.253714945064,
    '20': 9398.413461229278,
    '21': 0,
    '22': 0,
    '23': 0,
    '24': 0,
    '25': 0,
    '26': 0,
    '27': 0,
    '28': 0,
    '29': 0,
    '30': 0,
    '31': 0,
    '32': 0,
    '33': 0,
    '34': 0,
    '35': 0,
    '36': 0,
    '37': 0,
    '38': 0,
    '39': 0,
    '40': 0,
    '-1': 0,
  },
  areaRestoredOrConservedPlan: {
    '1': 10000,
    '2': 10000,
    '3': 10000,
    '4': 10000,
    '5': 10000,
    '6': 10000,
    '7': 10000,
    '8': 10000,
    '9': 10000,
    '10': 10000,
    '11': 10000,
    '12': 10000,
    '13': 10000,
    '14': 10000,
    '15': 10000,
    '16': 10000,
    '17': 10000,
    '18': 10000,
    '19': 10000,
    '20': 10000,
    '21': 0,
    '22': 0,
    '23': 0,
    '24': 0,
    '25': 0,
    '26': 0,
    '27': 0,
    '28': 0,
    '29': 0,
    '30': 0,
    '31': 0,
    '32': 0,
    '33': 0,
    '34': 0,
    '35': 0,
    '36': 0,
    '37': 0,
    '38': 0,
    '39': 0,
    '40': 0,
    '-1': 10000,
  },
  annualAvoidedLoss: {
    '1': 10,
    '2': 9.989999999999782,
    '3': 9.98000999999931,
    '4': 9.970029990001422,
    '5': 9.960059960008948,
    '6': 9.95009990005019,
    '7': 9.940149800149811,
    '8': 9.930209650350662,
    '9': 9.920279440699233,
    '10': 9.910359161258384,
    '11': 9.900448802098254,
    '12': 9.890548353294434,
    '13': 9.88065780494253,
    '14': 9.870777147136323,
    '15': 9.860906369991426,
    '16': 9.851045463617993,
    '17': 9.841194418157102,
    '18': 9.831353223738915,
    '19': 9.821521870515426,
    '20': 9.811700348642262,
    '21': 0,
    '22': 0,
    '23': 0,
    '24': 0,
    '25': 0,
    '26': 0,
    '27': 0,
    '28': 0,
    '29': 0,
    '30': 0,
    '31': 0,
    '32': 0,
    '33': 0,
    '34': 0,
    '35': 0,
    '36': 0,
    '37': 0,
    '38': 0,
    '39': 0,
    '40': 0,
  },
  netEmissionsReduction: {
    '1': 4332.150353907905,
    '2': 5105.984619809687,
    '3': 5879.0450514454415,
    '4': 6651.332422650642,
    '5': 7422.847506482816,
    '6': 8193.591075232578,
    '7': 8963.563900413004,
    '8': 9732.766752768799,
    '9': 10501.200402271417,
    '10': 11268.86561812485,
    '11': 11316.996752507184,
    '12': 11365.079755754006,
    '13': 11413.114675998831,
    '14': 11461.101561322217,
    '15': 11509.040459761876,
    '16': 11556.93141930072,
    '17': 11604.774487882452,
    '18': 11652.569713394549,
    '19': 11700.31714368133,
    '20': 11748.016826536597,
    '21': 0,
    '22': 0,
    '23': 0,
    '24': 0,
    '25': 0,
    '26': 0,
    '27': 0,
    '28': 0,
    '29': 0,
    '30': 0,
    '31': 0,
    '32': 0,
    '33': 0,
    '34': 0,
    '35': 0,
    '36': 0,
    '37': 0,
    '38': 0,
    '39': 0,
    '40': 0,
    '-1': 0,
  },
} as SequestrationRateOutputs;

const revenueProfitCalculator = new RevenueProfitCalculator(
  engineInput.projectInput,
  sequestrationRateOutputs.estimatedCreditIssuedPlan,
);

const initialCostPlan = {
  totalOpex: 3129247.2889232035,
  totalCapex: 1371800.0000000014,
  totalCapexNPV: 1288099.1380291318,
  totalOpexNPV: 1801518.9597601069,
  totalNPV: 3089618.0977892387,
  costPerTCO2e: 19.971231729447208,
  costPerHa: 308.96180977892385,
  npvCoveringCosts: 279545.0276978903,
  totalCreditsIssued: 154703.4323993975,
  IRROpex: 0.21182252589229567,
  IRRTotalCost: -0.04898328189178924,
  totalRevenueNPV: 2081063.9874579972,
  totalRevenue: 3700613.2048866497,
  financingCost: 68590.00000000007,
  fundingGap: 0,
  fundingGapNPV: 0,
  fundingGapPerTCO2e: 0,
  totalCommunityBenefitSharingFund: 0.5,
  annualNetCashFlow: {
    '0': 0,
    '1': -6916.083182893082,
    '2': -134.45349962209002,
    '3': 6840.074999346791,
    '4': 14011.641184309236,
    '5': -53615.5365449816,
    '6': 28962.841177671537,
    '7': 36751.15614668118,
    '8': 44753.87407199957,
    '9': 52975.54609214098,
    '10': -53579.18968645076,
    '11': 63436.03491304719,
    '12': 65487.954247792164,
    '13': 67577.20732458017,
    '14': 69704.44397598138,
    '15': -3129.674959827302,
    '16': 74075.52254349715,
    '17': 76320.7198862783,
    '18': 78606.61203134718,
    '19': 80933.90569595186,
    '20': -31696.680453405133,
    '-4': -314616.66666666704,
    '-3': -311283.3333333337,
    '-2': -311283.3333333337,
    '-1': -474616.666666667,
  },
  annualNetIncome: {
    '0': 0,
    '1': -6916.083182893082,
    '2': -134.45349962209002,
    '3': 6840.074999346791,
    '4': 14011.641184309236,
    '5': -53615.5365449816,
    '6': 28962.841177671537,
    '7': 36751.15614668118,
    '8': 44753.87407199957,
    '9': 52975.54609214098,
    '10': -53579.18968645076,
    '11': 63436.03491304719,
    '12': 65487.954247792164,
    '13': 67577.20732458017,
    '14': 69704.44397598138,
    '15': -3129.674959827302,
    '16': 74075.52254349715,
    '17': 76320.7198862783,
    '18': 78606.61203134718,
    '19': 80933.90569595186,
    '20': -31696.680453405133,
    '-4': 0,
    '-3': 0,
    '-2': 0,
    '-1': -40000,
  },
  estimatedRevenuePlan: {
    '1': 70354.12174746436,
    '2': 84165.00807909493,
    '3': 98361.44441515613,
    '4': 112951.70874386668,
    '5': 127944.23811211127,
    '6': 143347.6314994175,
    '7': 159170.65274149453,
    '8': 175422.23350488517,
    '9': 192111.47631300884,
    '10': 209247.65762489842,
    '11': 213293.50878689668,
    '12': 217412.73401742562,
    '13': 221606.61134547996,
    '14': 225876.44045158586,
    '15': 230223.54302746922,
    '16': 234649.26314117055,
    '17': 239154.96760867897,
    '18': 243742.04637098065,
    '19': 248411.91287788172,
    '20': 253166.00447768142,
    '21': 0,
    '22': 0,
    '23': 0,
    '24': 0,
    '25': 0,
    '26': 0,
    '27': 0,
    '28': 0,
    '29': 0,
    '30': 0,
    '31': 0,
    '32': 0,
    '33': 0,
    '34': 0,
    '35': 0,
    '36': 0,
    '37': 0,
    '38': 0,
    '39': 0,
    '40': 0,
    '-4': 0,
    '-3': 0,
    '-2': 0,
    '-1': 0,
  },
  creditsIssuedPlan: {
    '1': 3465.720283126324,
    '2': 4084.7876958477495,
    '3': 4703.236041156353,
    '4': 5321.065938120514,
    '5': 5938.278005186254,
    '6': 6554.872860186063,
    '7': 7170.851120330404,
    '8': 7786.213402215039,
    '9': 8400.960321817134,
    '10': 9015.09249449988,
    '11': 9053.597402005747,
    '12': 9092.063804603205,
    '13': 9130.491740799065,
    '14': 9168.881249057775,
    '15': 9207.232367809502,
    '16': 9245.545135440576,
    '17': 9283.819590305962,
    '18': 9322.055770715639,
    '19': 9360.253714945064,
    '20': 9398.413461229278,
    '21': 0,
    '22': 0,
    '23': 0,
    '24': 0,
    '25': 0,
    '26': 0,
    '27': 0,
    '28': 0,
    '29': 0,
    '30': 0,
    '31': 0,
    '32': 0,
    '33': 0,
    '34': 0,
    '35': 0,
    '36': 0,
    '37': 0,
    '38': 0,
    '39': 0,
    '40': 0,
    '-1': 0,
  },
} as CalculatorCostPlansOutput;

export const SENSITIVITY_ANALYSIS_INPUT_FIXTURES: SensitivityAnalysisInput = {
  engineInput,
  sequestrationRateOutputs,
  revenueProfitCalculator,
  initialCostPlanOutput: initialCostPlan,
};
